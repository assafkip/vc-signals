<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal Dashboard - Cybersecurity Intelligence</title>
    <meta name="description" content="Real-time intelligence on cybersecurity VC investments and security research.">

    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-900: #111827;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-900);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        header { text-align: center; padding: 40px 20px; color: white; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header p { font-size: 1.1rem; opacity: 0.9; }

        .stats-bar { display: flex; justify-content: center; gap: 40px; margin-top: 20px; flex-wrap: wrap; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .stat { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.85rem; color: var(--gray-500); }

        .filters-panel { background: white; border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }

        /* Search bar */
        .search-container { margin-bottom: 16px; position: relative; }
        .search-input { width: 100%; padding: 12px 40px 12px 16px; border: 2px solid var(--gray-200); border-radius: 10px; font-size: 1rem; }
        .search-input:focus { outline: none; border-color: var(--primary); }
        .search-clear { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--gray-500); display: none; }
        .search-results { font-size: 0.8rem; color: var(--gray-500); margin-top: 6px; display: none; }

        .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 16px; }
        .filter-group label { display: block; font-size: 0.75rem; color: var(--gray-500); margin-bottom: 6px; text-transform: uppercase; }
        .filter-group select { width: 100%; padding: 10px 12px; border: 2px solid var(--gray-200); border-radius: 8px; font-size: 0.9rem; background: white; cursor: pointer; }
        .filter-group select:focus { outline: none; border-color: var(--primary); }
        .filter-group select option:disabled { color: var(--gray-500); }

        .filter-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .chip, .sec-chip { padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; border: 2px solid var(--gray-200); background: white; }
        .chip:hover, .sec-chip:hover { border-color: var(--primary); }
        .chip.active, .sec-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        .theme-summary { background: var(--gray-100); border-radius: 12px; padding: 20px; margin-top: 16px; display: none; }
        .theme-summary.visible { display: block; }
        .theme-summary h3 { font-size: 1rem; margin-bottom: 16px; color: var(--gray-700); }
        .theme-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .theme-card { background: white; padding: 16px; border-radius: 10px; text-align: center; cursor: pointer; transition: transform 0.2s; }
        .theme-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .theme-card .count { font-size: 1.8rem; font-weight: 700; color: var(--primary); }
        .theme-card .label { font-size: 0.75rem; color: var(--gray-500); }

        /* Source legend */
        .source-legend { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; font-size: 0.7rem; }
        .source-badge { padding: 3px 8px; border-radius: 4px; color: white; }

        .signals-container { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .signals-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
        .signals-count { font-size: 0.9rem; color: var(--gray-500); }
        .signals-list { display: flex; flex-direction: column; gap: 16px; }

        .signal-card { border: 1px solid var(--gray-200); border-radius: 12px; padding: 20px; border-left: 4px solid var(--warning); transition: transform 0.2s; }
        .signal-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.08); transform: translateX(4px); }
        .signal-card.hard { border-left-color: var(--danger); }
        .signal-card.soft { border-left-color: var(--warning); }

        .signal-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; flex-wrap: wrap; gap: 8px; }
        .signal-person { font-size: 1.1rem; font-weight: 600; }
        .signal-firm { color: var(--gray-500); font-size: 0.9rem; }
        .signal-badges { display: flex; gap: 6px; flex-wrap: wrap; }
        .badge { padding: 3px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 500; }
        .badge.hard { background: #fef2f2; color: var(--danger); }
        .badge.soft { background: #fffbeb; color: var(--warning); }
        .badge.high { background: #dcfce7; color: #166534; }
        .badge.med { background: #fef3c7; color: #92400e; }

        .signal-category { display: inline-block; background: #e0e7ff; color: #3730a3; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; margin-bottom: 12px; }
        .signal-summary { font-size: 0.95rem; line-height: 1.6; color: var(--gray-700); margin-bottom: 12px; }
        .signal-excerpt { background: var(--gray-100); padding: 12px 16px; border-radius: 8px; font-size: 0.85rem; color: var(--gray-500); font-style: italic; margin-bottom: 12px; }
        .signal-footer { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
        .signal-meta { font-size: 0.8rem; color: var(--gray-500); }
        .signal-link { color: var(--primary); text-decoration: none; font-size: 0.85rem; font-weight: 500; }
        .signal-link:hover { text-decoration: underline; }

        .empty-state { text-align: center; padding: 60px 20px; color: var(--gray-500); }
        .loading-state { text-align: center; padding: 60px 20px; color: var(--gray-500); }
        .loading-spinner { display: inline-block; width: 40px; height: 40px; border: 3px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .view-toggles { display: flex; gap: 16px; align-items: center; font-size: 0.85rem; }
        .view-toggles label { display: flex; align-items: center; gap: 6px; cursor: pointer; }

        .refresh-btn { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .refresh-btn:hover { background: var(--primary-dark); }

        footer { text-align: center; padding: 40px 20px; color: white; opacity: 0.8; font-size: 0.85rem; }

        /* Tab navigation */
        .tab-nav { display: flex; justify-content: center; gap: 12px; margin-top: 24px; }
        .tab-btn { padding: 12px 24px; border: 2px solid rgba(255,255,255,0.3); border-radius: 30px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .tab-btn:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.5); }
        .tab-btn.active { background: white; color: var(--primary-dark); border-color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Security signal specific styles */
        .signal-card.critical { border-left-color: #dc2626; }
        .signal-card.high { border-left-color: #ea580c; }
        .signal-card.medium { border-left-color: #f59e0b; }
        .signal-card.low { border-left-color: #16a34a; }
        .signal-card.informational { border-left-color: #6b7280; }

        .badge.critical { background: #fef2f2; color: #dc2626; }
        .badge.high-sev { background: #fff7ed; color: #ea580c; }
        .badge.medium-sev { background: #fffbeb; color: #d97706; }
        .badge.low-sev { background: #f0fdf4; color: #16a34a; }
        .badge.info-sev { background: #f3f4f6; color: #6b7280; }

        .cve-tag { display: inline-block; background: #fee2e2; color: #991b1b; padding: 2px 8px; border-radius: 4px; font-family: monospace; font-size: 0.75rem; margin-right: 4px; margin-bottom: 4px; }
        .threat-actor-tag { display: inline-block; background: #fef3c7; color: #92400e; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 4px; margin-bottom: 4px; }
        .malware-tag { display: inline-block; background: #ede9fe; color: #5b21b6; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-right: 4px; margin-bottom: 4px; }
        .signal-tags { margin-top: 8px; margin-bottom: 12px; }

        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .stats-bar { gap: 20px; }
            .stat-value { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Signal Dashboard</h1>
        <p>Real-time intelligence on cybersecurity investments and security research</p>
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('vc')">VC Signals</button>
            <button class="tab-btn" onclick="switchTab('security')">Security Signals</button>
        </div>
    </header>

    <div class="container">
        <!-- VC Signals Tab -->
        <div id="vcTab" class="tab-content active">
        <div class="stats-bar" style="margin-bottom: 24px;">
            <div class="stat"><div class="stat-value" id="totalSignals">-</div><div class="stat-label">Total Signals</div></div>
            <div class="stat"><div class="stat-value" id="hardSignals">-</div><div class="stat-label">Hard Signals</div></div>
            <div class="stat"><div class="stat-value" id="softSignals">-</div><div class="stat-label">Soft Signals</div></div>
            <div class="stat"><div class="stat-value" id="sourcesCount">-</div><div class="stat-label">Sources</div></div>
        </div>
        <div class="filters-panel">
            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search signals by keyword (title, excerpt, person, firm...)">
                <button class="search-clear" id="searchClear" onclick="clearSearch()">x</button>
                <div class="search-results" id="searchResults"></div>
            </div>

            <div class="filters-grid">
                <div class="filter-group">
                    <label>Date Range</label>
                    <select id="filterDate">
                        <option value="all">All Time</option>
                        <option value="1day">Past 1 Day</option>
                        <option value="7days" selected>Past 7 Days</option>
                        <option value="14days">Past 14 Days</option>
                        <option value="month">Past Month</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Source</label>
                    <select id="filterSource">
                        <option value="all">All Sources</option>
                        <option value="blog">Blog</option>
                        <option value="conference">Conference</option>
                        <option value="crunchbase">Crunchbase</option>
                        <option value="hackernews">Hacker News</option>
                        <option value="linkedin">LinkedIn</option>
                        <option value="medium">Medium</option>
                        <option value="news">News</option>
                        <option value="podcast">Podcast</option>
                        <option value="press">Press Release</option>
                        <option value="producthunt">ProductHunt</option>
                        <option value="substack">Substack</option>
                        <option value="x">X / Twitter</option>
                        <option value="youtube">YouTube</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Person</label>
                    <select id="filterPerson"><option value="all">All People</option></select>
                </div>
                <div class="filter-group">
                    <label>Firm</label>
                    <select id="filterFirm"><option value="all">All Firms</option></select>
                </div>
                <div class="filter-group">
                    <label>Theme</label>
                    <select id="filterTheme">
                        <option value="all">All Themes</option>
                        <option value="threat_detection">Threat Detection</option>
                        <option value="investment_activity">Investment Activity</option>
                        <option value="market_insights">Market Insights</option>
                        <option value="soc_pain">SOC Pain Points</option>
                        <option value="relationship">Relationship Signals</option>
                        <option value="ai_security">AI Security Trends</option>
                        <option value="agentic">Agentic AI</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <div class="filter-chips">
                <span class="chip active" data-filter="all">All Signals</span>
                <span class="chip" data-filter="hard" style="background: #fef2f2; color: var(--danger); border-color: #fecaca;">Hard Signals</span>
                <span class="chip" data-filter="soft" style="background: #fffbeb; color: var(--warning); border-color: #fde68a;">Soft Signals</span>
            </div>

            <div class="view-toggles">
                <label><input type="checkbox" id="showThemeSummary"> Show Theme Summary</label>
                <button class="refresh-btn" onclick="loadSignals()">Refresh</button>
            </div>

            <div class="theme-summary" id="themeSummary">
                <h3>Trending Themes (Selected Time Range)</h3>
                <div class="theme-cards" id="themeCards"></div>
            </div>
        </div>

        <!-- Source Legend -->
        <div class="source-legend">
            <span class="source-badge" style="background: #0077b5;">LinkedIn</span>
            <span class="source-badge" style="background: #1da1f2;">X/Twitter</span>
            <span class="source-badge" style="background: #ff6b35;">Crunchbase</span>
            <span class="source-badge" style="background: #00d4aa;">TechCrunch</span>
            <span class="source-badge" style="background: #00ab6c;">Medium</span>
            <span class="source-badge" style="background: #da552f;">ProductHunt</span>
            <span class="source-badge" style="background: #ff6600;">Hacker News</span>
            <span class="source-badge" style="background: #ff6719;">Substack</span>
            <span class="source-badge" style="background: #6b7280;">Press</span>
            <span class="source-badge" style="background: #7c3aed;">Blog</span>
        </div>

        <div class="signals-container">
            <div class="signals-header">
                <span class="signals-count" id="signalsCount">Loading signals...</span>
            </div>
            <div class="signals-list" id="signalsList">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading signals...</p>
                </div>
            </div>
        </div>
        </div><!-- End VC Signals Tab -->

        <!-- Security Signals Tab -->
        <div id="securityTab" class="tab-content">
        <div class="stats-bar" style="margin-bottom: 24px;">
            <div class="stat"><div class="stat-value" id="secTotalSignals">-</div><div class="stat-label">Total Signals</div></div>
            <div class="stat"><div class="stat-value" id="secCriticalSignals">-</div><div class="stat-label">Critical</div></div>
            <div class="stat"><div class="stat-value" id="secHighSignals">-</div><div class="stat-label">High</div></div>
            <div class="stat"><div class="stat-value" id="secSourcesCount">-</div><div class="stat-label">Sources</div></div>
        </div>
        <div class="filters-panel">
            <!-- Security Search Bar -->
            <div class="search-container">
                <input type="text" class="search-input" id="secSearchInput" placeholder="Search security signals by CVE, threat actor, malware, keyword...">
                <button class="search-clear" id="secSearchClear" onclick="clearSecuritySearch()">x</button>
                <div class="search-results" id="secSearchResults"></div>
            </div>

            <div class="filters-grid">
                <div class="filter-group">
                    <label>Date Range</label>
                    <select id="secFilterDate">
                        <option value="all">All Time</option>
                        <option value="1day">Past 1 Day</option>
                        <option value="7days" selected>Past 7 Days</option>
                        <option value="14days">Past 14 Days</option>
                        <option value="month">Past Month</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Source Type</label>
                    <select id="secFilterSourceType">
                        <option value="all">All Sources</option>
                        <option value="government">Government</option>
                        <option value="vendor_research">Vendor Research</option>
                        <option value="independent_research">Independent Research</option>
                        <option value="vulnerability_db">Vulnerability DB</option>
                        <option value="threat_tracking">Threat Tracking</option>
                        <option value="news">News</option>
                        <option value="community">Community</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Severity</label>
                    <select id="secFilterSeverity">
                        <option value="all">All Severities</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                        <option value="informational">Informational</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category</label>
                    <select id="secFilterCategory">
                        <option value="all">All Categories</option>
                        <option value="cve">CVE / Vulnerability</option>
                        <option value="malware">Malware</option>
                        <option value="apt">APT / Threat Actor</option>
                        <option value="advisory">Advisory</option>
                        <option value="research">Research</option>
                        <option value="news">News</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Source</label>
                    <select id="secFilterSource"><option value="all">All Sources</option></select>
                </div>
            </div>

            <div class="filter-chips">
                <span class="sec-chip active" data-filter="all">All Severities</span>
                <span class="sec-chip" data-filter="critical" style="background: #fef2f2; color: #dc2626; border-color: #fecaca;">Critical</span>
                <span class="sec-chip" data-filter="high" style="background: #fff7ed; color: #ea580c; border-color: #fed7aa;">High</span>
                <span class="sec-chip" data-filter="medium" style="background: #fffbeb; color: #d97706; border-color: #fde68a;">Medium</span>
            </div>

            <div class="view-toggles">
                <button class="refresh-btn" onclick="loadSecuritySignals()">Refresh</button>
            </div>
        </div>

        <!-- Source Legend for Security -->
        <div class="source-legend">
            <span class="source-badge" style="background: #0369a1;">Government</span>
            <span class="source-badge" style="background: #7c3aed;">Vendor Research</span>
            <span class="source-badge" style="background: #059669;">Independent</span>
            <span class="source-badge" style="background: #dc2626;">Vulnerability DB</span>
            <span class="source-badge" style="background: #ea580c;">Threat Tracking</span>
            <span class="source-badge" style="background: #6b7280;">News</span>
        </div>

        <div class="signals-container">
            <div class="signals-header">
                <span class="signals-count" id="secSignalsCount">Loading signals...</span>
            </div>
            <div class="signals-list" id="secSignalsList">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading security signals...</p>
                </div>
            </div>
        </div>
        </div><!-- End Security Signals Tab -->
    </div>

    <footer>
        <p>Signal Dashboard - VC + Security Intelligence</p>
        <p>Run <code>python3 scripts/live_monitor.py</code> for VC signals | <code>python3 scripts/security_monitor.py</code> for security signals</p>
    </footer>

    <script>
        let signals = [];
        let securitySignals = [];
        let currentTab = 'vc';

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tab === 'vc') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('vcTab').classList.add('active');
            } else {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('securityTab').classList.add('active');
                if (securitySignals.length === 0) {
                    loadSecuritySignals();
                }
            }
        }

        // Load signals from JSON
        async function loadSignals() {
            try {
                const cacheBuster = Date.now();
                const response = await fetch(`signals-data.json?t=${cacheBuster}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                signals = await response.json();

                updateStats();
                populateDropdowns();
                applyFilters();

                console.log(`Loaded ${signals.length} signals`);
            } catch (error) {
                console.error('Failed to load signals:', error);
                document.getElementById('signalsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Failed to load signals</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalSignals').textContent = signals.length;
            document.getElementById('hardSignals').textContent = signals.filter(s => s.signal_type === 'hard').length;
            document.getElementById('softSignals').textContent = signals.filter(s => s.signal_type === 'soft').length;
            document.getElementById('sourcesCount').textContent = new Set(signals.map(s => s.source_type)).size;
        }

        // Populate dropdowns with counts
        function populateDropdowns() {
            // Person dropdown
            const personCounts = {};
            signals.forEach(s => {
                if (s.person_name) personCounts[s.person_name] = (personCounts[s.person_name] || 0) + 1;
            });
            const sortedPersons = Object.entries(personCounts).sort((a, b) => b[1] - a[1]);

            const personSelect = document.getElementById('filterPerson');
            personSelect.innerHTML = '';
            const allPersonOpt = document.createElement('option');
            allPersonOpt.value = 'all';
            allPersonOpt.textContent = `All People (${signals.length})`;
            personSelect.appendChild(allPersonOpt);
            sortedPersons.forEach(([name, count]) => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = `${name} (${count})`;
                personSelect.appendChild(opt);
            });

            // Firm dropdown
            const firmCounts = {};
            signals.forEach(s => {
                if (s.firm) firmCounts[s.firm] = (firmCounts[s.firm] || 0) + 1;
            });
            const sortedFirms = Object.entries(firmCounts).sort((a, b) => b[1] - a[1]);

            const firmSelect = document.getElementById('filterFirm');
            firmSelect.innerHTML = '';
            const allFirmOpt = document.createElement('option');
            allFirmOpt.value = 'all';
            allFirmOpt.textContent = `All Firms (${signals.length})`;
            firmSelect.appendChild(allFirmOpt);
            sortedFirms.forEach(([firm, count]) => {
                const opt = document.createElement('option');
                opt.value = firm;
                opt.textContent = `${firm} (${count})`;
                firmSelect.appendChild(opt);
            });
        }

        // Theme classification - matches internal tool
        function getSignalTheme(signal) {
            const category = signal.signal_category || '';
            const summary = (signal.summary || '').toLowerCase();
            const excerpt = (signal.excerpt || '').toLowerCase();
            const content = summary + ' ' + excerpt;

            // Threat Detection
            if (['detection_engineering', 'threat_intelligence', 'problem_post_detection_gaps'].includes(category)) {
                return 'threat_detection';
            }
            if (content.includes('threat intel') || content.includes('threat hunting') ||
                content.includes('sigma rule') || content.includes('yara rule') ||
                content.includes('mitre att&ck') || content.includes('mitre attack') ||
                content.includes('malware analysis') || content.includes('detection rules') ||
                content.includes('detection-as-code') || content.includes('detection engineering') ||
                content.includes('threat actor') || content.includes('threat detection') ||
                content.includes('detection coverage') || content.includes('indicator of compromise') ||
                content.includes('ransomware') || content.includes('apt ') || content.includes('cve-')) {
                return 'threat_detection';
            }

            // Investment activity
            if (['new_fund_raised', 'new_security_investment', 'actively_looking', 'new_thesis_statement'].includes(category)) {
                return 'investment_activity';
            }
            if (content.includes('raised') || content.includes('funding round') ||
                content.includes('series a') || content.includes('series b') || content.includes('seed round') ||
                content.includes('investment') || content.includes('venture capital')) {
                return 'investment_activity';
            }

            // SOC Pain points
            if (category === 'problem_post_soc_pain') {
                return 'soc_pain';
            }
            if (content.includes('alert fatigue') || content.includes('false positive') ||
                content.includes('security operations') || content.includes('soc analyst') ||
                content.includes('incident response') || content.includes('triage')) {
                return 'soc_pain';
            }

            // Agentic AI
            if (content.includes('agentic') || content.includes('autonomous security') ||
                content.includes('ai agent') || content.includes('security automation')) {
                return 'agentic';
            }

            // AI Security
            if (content.includes('ai security') || content.includes('ai-powered') ||
                content.includes('llm security') || content.includes('ai safety') ||
                content.includes('machine learning') || content.includes('generative ai')) {
                return 'ai_security';
            }

            // Market insights
            if (['security_trend_commentary', 'critique_current_tools'].includes(category)) {
                return 'market_insights';
            }

            // Relationship signals
            if (['portfolio_adjacent_win', 'public_ask_intros'].includes(category)) {
                return 'relationship';
            }
            if (content.includes('acquisition') || content.includes('acquired') ||
                content.includes('ipo') || content.includes('exit')) {
                return 'relationship';
            }

            return 'other';
        }

        function getThemeLabel(theme) {
            const labels = {
                'threat_detection': 'Threat Detection',
                'investment_activity': 'Investment Activity',
                'market_insights': 'Market Insights',
                'soc_pain': 'SOC Pain Points',
                'relationship': 'Relationship Signals',
                'ai_security': 'AI Security Trends',
                'agentic': 'Agentic AI',
                'other': 'Other'
            };
            return labels[theme] || theme;
        }

        // Source colors
        function getSourceColor(sourceType) {
            const colors = {
                linkedin: '#0077b5',
                x: '#1da1f2',
                crunchbase: '#ff6b35',
                news: '#00d4aa',
                medium: '#00ab6c',
                producthunt: '#da552f',
                hackernews: '#ff6600',
                substack: '#ff6719',
                press: '#6b7280',
                blog: '#7c3aed',
                podcast: '#8b5cf6',
                conference: '#6366f1',
                youtube: '#ff0000'
            };
            return colors[sourceType?.toLowerCase()] || '#6b7280';
        }

        // Apply filters
        function applyFilters() {
            const searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
            const dateFilter = document.getElementById('filterDate').value;
            const sourceFilter = document.getElementById('filterSource').value;
            const personFilter = document.getElementById('filterPerson').value;
            const firmFilter = document.getElementById('filterFirm').value;
            const themeFilter = document.getElementById('filterTheme').value;
            const typeFilter = document.querySelector('.chip.active')?.dataset.filter || 'all';

            let filtered = [...signals];
            const totalBefore = filtered.length;

            // Search filter with word boundary
            if (searchQuery) {
                const searchTerms = searchQuery.split(/\s+/).filter(t => t.length > 0);
                filtered = filtered.filter(s => {
                    const searchableText = [
                        s.summary || '',
                        s.excerpt || '',
                        s.person_name || '',
                        s.firm || '',
                        s.signal_category || '',
                        s.source_type || ''
                    ].join(' ').toLowerCase();

                    return searchTerms.every(term => {
                        const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`\\b${escapedTerm}`, 'i');
                        return regex.test(searchableText);
                    });
                });

                document.getElementById('searchResults').style.display = 'block';
                document.getElementById('searchResults').textContent = `Found ${filtered.length} of ${totalBefore} signals matching "${searchQuery}"`;
                document.getElementById('searchClear').style.display = 'block';
            } else {
                document.getElementById('searchResults').style.display = 'none';
                document.getElementById('searchClear').style.display = 'none';
            }

            // Type filter
            if (typeFilter === 'hard') filtered = filtered.filter(s => s.signal_type === 'hard');
            else if (typeFilter === 'soft') filtered = filtered.filter(s => s.signal_type === 'soft');

            // Date filter
            if (dateFilter !== 'all') {
                const now = new Date();
                const cutoff = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                if (dateFilter === '1day') cutoff.setDate(cutoff.getDate() - 1);
                else if (dateFilter === '7days') cutoff.setDate(cutoff.getDate() - 7);
                else if (dateFilter === '14days') cutoff.setDate(cutoff.getDate() - 14);
                else if (dateFilter === 'month') cutoff.setDate(cutoff.getDate() - 30);

                filtered = filtered.filter(s => {
                    if (!s.source_date) return true;
                    const parts = s.source_date.split('-');
                    const signalDate = new Date(parts[0], parts[1] - 1, parts[2]);
                    return signalDate >= cutoff;
                });
            }

            // Source filter
            if (sourceFilter !== 'all') {
                filtered = filtered.filter(s => s.source_type?.toLowerCase() === sourceFilter.toLowerCase());
            }

            // Person filter
            if (personFilter !== 'all') {
                filtered = filtered.filter(s => s.person_name === personFilter);
            }

            // Firm filter
            if (firmFilter !== 'all') {
                filtered = filtered.filter(s => s.firm === firmFilter);
            }

            // Update theme dropdown with counts BEFORE applying theme filter
            updateThemeDropdownCounts(filtered);

            // Theme filter
            if (themeFilter !== 'all') {
                filtered = filtered.filter(s => getSignalTheme(s) === themeFilter);
            }

            renderSignals(filtered);
            updateThemeSummary(filtered);
        }

        // Update theme dropdown with counts
        function updateThemeDropdownCounts(filteredSignals) {
            const themeSelect = document.getElementById('filterTheme');
            const currentValue = themeSelect.value;

            const themeCounts = {};
            filteredSignals.forEach(s => {
                const theme = getSignalTheme(s);
                themeCounts[theme] = (themeCounts[theme] || 0) + 1;
            });

            const themeLabels = {
                'all': 'All Themes',
                'threat_detection': 'Threat Detection',
                'investment_activity': 'Investment Activity',
                'market_insights': 'Market Insights',
                'soc_pain': 'SOC Pain Points',
                'relationship': 'Relationship Signals',
                'ai_security': 'AI Security Trends',
                'agentic': 'Agentic AI',
                'other': 'Other'
            };

            themeSelect.innerHTML = '';

            const allOpt = document.createElement('option');
            allOpt.value = 'all';
            allOpt.textContent = `All Themes (${filteredSignals.length})`;
            themeSelect.appendChild(allOpt);

            Object.keys(themeLabels).forEach(theme => {
                if (theme === 'all') return;
                const count = themeCounts[theme] || 0;
                const opt = document.createElement('option');
                opt.value = theme;
                opt.textContent = `${themeLabels[theme]} (${count})`;
                if (count === 0) {
                    opt.disabled = true;
                    opt.style.color = '#9ca3af';
                }
                themeSelect.appendChild(opt);
            });

            themeSelect.value = currentValue;
        }

        // Update theme summary
        function updateThemeSummary(filteredSignals) {
            const showSummary = document.getElementById('showThemeSummary').checked;
            const summaryDiv = document.getElementById('themeSummary');

            if (!showSummary) {
                summaryDiv.classList.remove('visible');
                return;
            }
            summaryDiv.classList.add('visible');

            const themeCounts = {};
            filteredSignals.forEach(s => {
                const theme = getSignalTheme(s);
                themeCounts[theme] = (themeCounts[theme] || 0) + 1;
            });

            const sortedThemes = Object.entries(themeCounts).sort((a, b) => b[1] - a[1]);

            document.getElementById('themeCards').innerHTML = sortedThemes.map(([theme, count]) => `
                <div class="theme-card" onclick="filterByTheme('${theme}')">
                    <div class="count">${count}</div>
                    <div class="label">${getThemeLabel(theme)}</div>
                </div>
            `).join('');
        }

        function filterByTheme(theme) {
            document.getElementById('filterTheme').value = theme;
            applyFilters();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            applyFilters();
        }

        // ========== SECURITY SIGNALS ==========

        // Load security signals from JSON
        async function loadSecuritySignals() {
            try {
                const cacheBuster = Date.now();
                const response = await fetch(`security-signals-data.json?t=${cacheBuster}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                securitySignals = await response.json();

                updateSecurityStats();
                populateSecurityDropdowns();
                applySecurityFilters();

                console.log(`Loaded ${securitySignals.length} security signals`);
            } catch (error) {
                console.error('Failed to load security signals:', error);
                document.getElementById('secSignalsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Failed to load security signals</h3>
                        <p>Error: ${error.message}</p>
                        <p>Run: python3 scripts/security_monitor.py</p>
                    </div>
                `;
            }
        }

        // Update security stats
        function updateSecurityStats() {
            document.getElementById('secTotalSignals').textContent = securitySignals.length;
            document.getElementById('secCriticalSignals').textContent = securitySignals.filter(s => s.severity === 'critical').length;
            document.getElementById('secHighSignals').textContent = securitySignals.filter(s => s.severity === 'high').length;
            document.getElementById('secSourcesCount').textContent = new Set(securitySignals.map(s => s.source_name)).size;
        }

        // Populate security dropdowns
        function populateSecurityDropdowns() {
            const sourceCounts = {};
            securitySignals.forEach(s => {
                if (s.source_name) sourceCounts[s.source_name] = (sourceCounts[s.source_name] || 0) + 1;
            });
            const sortedSources = Object.entries(sourceCounts).sort((a, b) => b[1] - a[1]);

            const sourceSelect = document.getElementById('secFilterSource');
            sourceSelect.innerHTML = '';
            const allOpt = document.createElement('option');
            allOpt.value = 'all';
            allOpt.textContent = `All Sources (${securitySignals.length})`;
            sourceSelect.appendChild(allOpt);
            sortedSources.forEach(([name, count]) => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = `${name} (${count})`;
                sourceSelect.appendChild(opt);
            });
        }

        // Get severity color
        function getSeverityColor(severity) {
            const colors = {
                critical: '#dc2626',
                high: '#ea580c',
                medium: '#f59e0b',
                low: '#16a34a',
                informational: '#6b7280'
            };
            return colors[severity] || '#6b7280';
        }

        // Get source type color
        function getSourceTypeColor(sourceType) {
            const colors = {
                government: '#0369a1',
                vendor_research: '#7c3aed',
                independent_research: '#059669',
                vulnerability_db: '#dc2626',
                threat_tracking: '#ea580c',
                news: '#6b7280',
                community: '#2563eb'
            };
            return colors[sourceType] || '#6b7280';
        }

        // Apply security filters
        function applySecurityFilters() {
            const searchQuery = document.getElementById('secSearchInput').value.trim().toLowerCase();
            const dateFilter = document.getElementById('secFilterDate').value;
            const sourceTypeFilter = document.getElementById('secFilterSourceType').value;
            const severityFilter = document.getElementById('secFilterSeverity').value;
            const categoryFilter = document.getElementById('secFilterCategory').value;
            const sourceFilter = document.getElementById('secFilterSource').value;
            const chipFilter = document.querySelector('.sec-chip.active')?.dataset.filter || 'all';

            let filtered = [...securitySignals];
            const totalBefore = filtered.length;

            // Search filter with word boundary
            if (searchQuery) {
                const searchTerms = searchQuery.split(/\s+/).filter(t => t.length > 0);
                filtered = filtered.filter(s => {
                    const searchableText = [
                        s.title || '',
                        s.summary || '',
                        s.source_name || '',
                        s.category || '',
                        (s.cve_ids || []).join(' '),
                        (s.threat_actors || []).join(' '),
                        (s.malware_families || []).join(' ')
                    ].join(' ').toLowerCase();

                    return searchTerms.every(term => {
                        const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`\\b${escapedTerm}`, 'i');
                        return regex.test(searchableText);
                    });
                });

                document.getElementById('secSearchResults').style.display = 'block';
                document.getElementById('secSearchResults').textContent = `Found ${filtered.length} of ${totalBefore} signals matching "${searchQuery}"`;
                document.getElementById('secSearchClear').style.display = 'block';
            } else {
                document.getElementById('secSearchResults').style.display = 'none';
                document.getElementById('secSearchClear').style.display = 'none';
            }

            // Chip filter (severity quick filter)
            if (chipFilter !== 'all') {
                filtered = filtered.filter(s => s.severity === chipFilter);
            }

            // Date filter
            if (dateFilter !== 'all') {
                const now = new Date();
                const cutoff = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                if (dateFilter === '1day') cutoff.setDate(cutoff.getDate() - 1);
                else if (dateFilter === '7days') cutoff.setDate(cutoff.getDate() - 7);
                else if (dateFilter === '14days') cutoff.setDate(cutoff.getDate() - 14);
                else if (dateFilter === 'month') cutoff.setDate(cutoff.getDate() - 30);

                filtered = filtered.filter(s => {
                    if (!s.published_date) return true;
                    const signalDate = new Date(s.published_date);
                    return signalDate >= cutoff;
                });
            }

            // Source type filter
            if (sourceTypeFilter !== 'all') {
                filtered = filtered.filter(s => s.source_type === sourceTypeFilter);
            }

            // Severity filter
            if (severityFilter !== 'all') {
                filtered = filtered.filter(s => s.severity === severityFilter);
            }

            // Category filter
            if (categoryFilter !== 'all') {
                filtered = filtered.filter(s => s.category === categoryFilter);
            }

            // Source filter
            if (sourceFilter !== 'all') {
                filtered = filtered.filter(s => s.source_name === sourceFilter);
            }

            renderSecuritySignals(filtered);
        }

        function clearSecuritySearch() {
            document.getElementById('secSearchInput').value = '';
            applySecurityFilters();
        }

        // Render security signals
        function renderSecuritySignals(filteredSignals) {
            const container = document.getElementById('secSignalsList');
            document.getElementById('secSignalsCount').textContent = `Showing ${filteredSignals.length} of ${securitySignals.length} signals`;

            if (filteredSignals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No security signals match your filters</h3>
                        <p>Try adjusting your filter criteria or use the Refresh button</p>
                    </div>
                `;
                return;
            }

            // Sort by date descending
            filteredSignals.sort((a, b) => new Date(b.published_date || '2020-01-01') - new Date(a.published_date || '2020-01-01'));

            container.innerHTML = filteredSignals.map(s => {
                const cveTagsHtml = (s.cve_ids || []).map(cve => `<span class="cve-tag">${escapeHtml(cve)}</span>`).join('');
                const threatActorTagsHtml = (s.threat_actors || []).map(ta => `<span class="threat-actor-tag">${escapeHtml(ta)}</span>`).join('');
                const malwareTagsHtml = (s.malware_families || []).map(mf => `<span class="malware-tag">${escapeHtml(mf)}</span>`).join('');
                const hasTags = cveTagsHtml || threatActorTagsHtml || malwareTagsHtml;

                return `
                <div class="signal-card ${s.severity || 'informational'}">
                    <div class="signal-header">
                        <div>
                            <div class="signal-person">${escapeHtml(s.title || 'Untitled')}</div>
                            <div class="signal-firm">${escapeHtml(s.source_name || 'Unknown')}</div>
                        </div>
                        <div class="signal-badges">
                            <span class="badge ${s.severity === 'critical' ? 'critical' : s.severity === 'high' ? 'high-sev' : s.severity === 'medium' ? 'medium-sev' : s.severity === 'low' ? 'low-sev' : 'info-sev'}">${(s.severity || 'info').toUpperCase()}</span>
                            <span class="source-badge" style="background: ${getSourceTypeColor(s.source_type)}">${(s.source_type || 'unknown').replace(/_/g, ' ')}</span>
                        </div>
                    </div>
                    <div class="signal-category">${escapeHtml((s.category || 'unknown').replace(/_/g, ' '))}</div>
                    ${hasTags ? `<div class="signal-tags">${cveTagsHtml}${threatActorTagsHtml}${malwareTagsHtml}</div>` : ''}
                    <div class="signal-summary">${escapeHtml(s.summary || '')}</div>
                    <div class="signal-footer">
                        <div class="signal-meta">${s.published_date ? new Date(s.published_date).toLocaleDateString() : 'N/A'}</div>
                        ${s.url ? `<a href="${s.url}" target="_blank" rel="noopener" class="signal-link">View Source</a>` : ''}
                    </div>
                </div>
            `}).join('');
        }

        // Render signals
        function renderSignals(filteredSignals) {
            const container = document.getElementById('signalsList');
            document.getElementById('signalsCount').textContent = `Showing ${filteredSignals.length} of ${signals.length} signals`;

            if (filteredSignals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No signals match your filters</h3>
                        <p>Try adjusting your filter criteria or use the Refresh button</p>
                    </div>
                `;
                return;
            }

            // Sort by date descending
            filteredSignals.sort((a, b) => new Date(b.source_date || '2020-01-01') - new Date(a.source_date || '2020-01-01'));

            container.innerHTML = filteredSignals.map(s => `
                <div class="signal-card ${s.signal_type}">
                    <div class="signal-header">
                        <div>
                            <div class="signal-person">${escapeHtml(s.person_name || 'Unknown')}</div>
                            <div class="signal-firm">${escapeHtml(s.firm || 'Unknown')}</div>
                        </div>
                        <div class="signal-badges">
                            <span class="badge ${s.signal_type}">${(s.signal_type || 'unknown').toUpperCase()}</span>
                            <span class="badge ${s.confidence}">${(s.confidence || 'med').toUpperCase()}</span>
                            <span class="source-badge" style="background: ${getSourceColor(s.source_type)}">${s.source_type || 'unknown'}</span>
                        </div>
                    </div>
                    <div class="signal-category">${escapeHtml((s.signal_category || 'unknown').replace(/_/g, ' '))}</div>
                    <div class="signal-summary">${escapeHtml(s.summary || '')}</div>
                    ${s.excerpt ? `<div class="signal-excerpt">"${escapeHtml(s.excerpt)}"</div>` : ''}
                    <div class="signal-footer">
                        <div class="signal-meta">${s.source_date || 'N/A'}</div>
                        ${s.source_url ? `<a href="${s.source_url}" target="_blank" rel="noopener" class="signal-link">View Source</a>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        // Event listeners
        document.querySelectorAll('.chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                applyFilters();
            });
        });

        ['filterDate', 'filterSource', 'filterPerson', 'filterFirm', 'filterTheme'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', applyFilters);
        });

        // Search input with debounce
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 300);
        });
        document.getElementById('searchInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                applyFilters();
            }
        });

        // Theme summary toggle
        document.getElementById('showThemeSummary').addEventListener('change', applyFilters);

        // Security signal event listeners
        document.querySelectorAll('.sec-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('.sec-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                applySecurityFilters();
            });
        });

        ['secFilterDate', 'secFilterSourceType', 'secFilterSeverity', 'secFilterCategory', 'secFilterSource'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', applySecurityFilters);
        });

        // Security search input with debounce
        let secSearchTimeout;
        document.getElementById('secSearchInput').addEventListener('input', () => {
            clearTimeout(secSearchTimeout);
            secSearchTimeout = setTimeout(applySecurityFilters, 300);
        });
        document.getElementById('secSearchInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(secSearchTimeout);
                applySecurityFilters();
            }
        });

        // Initialize
        loadSignals();
    </script>
</body>
</html>
